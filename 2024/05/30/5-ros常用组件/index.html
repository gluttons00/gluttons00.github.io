<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>5 ros常用组件 | 雪尘的博客</title><meta name="author" content="雪尘"><meta name="copyright" content="雪尘"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="&emsp;在ROS中内置一些比较实用的工具，通过这些工具可以方便快捷的实现某个功能或调试程序，从而提高开发效率，本章主要介绍ROS中内置的如下组件:  TF坐标变换，实现不同类型的坐标系之间的转换 rosbag 用于录制ROS节点的执行过程并可以重放该过程 rqt 工具箱，集成了多款图形化的调试工具  5.1 TF坐标变换&emsp;机器人系统上，有多个传感器，如激光雷达、摄像头等，有的传感器是">
<meta property="og:type" content="article">
<meta property="og:title" content="5 ros常用组件">
<meta property="og:url" content="http://example.com/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/index.html">
<meta property="og:site_name" content="雪尘的博客">
<meta property="og:description" content="&emsp;在ROS中内置一些比较实用的工具，通过这些工具可以方便快捷的实现某个功能或调试程序，从而提高开发效率，本章主要介绍ROS中内置的如下组件:  TF坐标变换，实现不同类型的坐标系之间的转换 rosbag 用于录制ROS节点的执行过程并可以重放该过程 rqt 工具箱，集成了多款图形化的调试工具  5.1 TF坐标变换&emsp;机器人系统上，有多个传感器，如激光雷达、摄像头等，有的传感器是">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/%E5%B0%81%E9%9D%A2-ros.png">
<meta property="article:published_time" content="2024-05-30T07:37:32.000Z">
<meta property="article:modified_time" content="2024-06-10T06:47:04.024Z">
<meta property="article:author" content="雪尘">
<meta property="article:tag" content="ros">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/%E5%B0%81%E9%9D%A2-ros.png"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="http://example.com/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '5 ros常用组件',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-10 14:47:04'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/./images/%E5%B0%81%E9%9D%A2-ros.png')"><nav id="nav"><span id="blog-info"><a href="/" title="雪尘的博客"><img class="site-icon" src="/img/logo.png"/><span class="site-name">雪尘的博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">5 ros常用组件</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-30T07:37:32.000Z" title="发表于 2024-05-30 15:37:32">2024-05-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-10T06:47:04.024Z" title="更新于 2024-06-10 14:47:04">2024-06-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ros/">ros</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="5 ros常用组件"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>&emsp;在ROS中内置一些比较实用的工具，通过这些工具可以方便快捷的实现某个功能或调试程序，从而提高开发效率，本章主要介绍ROS中内置的如下组件:</p>
<ul>
<li>TF坐标变换，实现不同类型的坐标系之间的转换</li>
<li>rosbag 用于录制ROS节点的执行过程并可以重放该过程</li>
<li>rqt 工具箱，集成了多款图形化的调试工具</li>
</ul>
<h1 id="5-1-TF坐标变换"><a href="#5-1-TF坐标变换" class="headerlink" title="5.1 TF坐标变换"></a>5.1 TF坐标变换</h1><p>&emsp;机器人系统上，有多个传感器，如激光雷达、摄像头等，有的传感器是可以感知机器人周边的物体方位(或者称之为:坐标，横向、纵向、高度的距离信息)的，以协助机器人定位障碍物，但这是相对于传感器的方位信息，若要使用，需要一个转换过程，使其变为相对于机器人或相关组件的方位信息。</p>
<p><strong>作用</strong>：在 ROS 中用于实现不同坐标系之间的点或向量的转换。</p>
<p><strong>说明</strong>：在ROS中坐标变换最初对应的是tf，不过在 hydro 版本开始, tf 被弃用，迁移到 tf2,后者更为简洁高效，</p>
<p><strong>tf2对应的常用功能包有</strong>：</p>
<p>tf2_geometry_msgs : 可以将ROS消息转换成tf2消息。</p>
<p>tf2 : 封装了坐标变换的常用消息。</p>
<p>tf2_ros : 为tf2提供了roscpp和rospy绑定，封装了坐标变换常用的API。</p>
<hr>
<h2 id="5-1-1-坐标msg消息"><a href="#5-1-1-坐标msg消息" class="headerlink" title="5.1.1 坐标msg消息"></a>5.1.1 坐标msg消息</h2><p>订阅发布模型中数据载体 msg 是一个重要实现，首先需要了解一下，在坐标转换实现中常用的 msg : <strong>geometry_msgs&#x2F;TransformStamped</strong> 和 <strong>geometry_msgs&#x2F;PointStamped</strong></p>
<p>前者用于传输坐标系相关位置信息，后者用于传输某个坐标系内坐标点的信息。在坐标变换中，频繁的需要使用到坐标系的相对关系以及坐标点信息。</p>
<p><strong>1. geometry_msgs&#x2F;TransformStamped</strong></p>
<p>命令行键入:<code>rosmsg info geometry_msgs/TransformStamped</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header                     <span class="comment">#头信息</span></span><br><span class="line">  uint32 seq                                <span class="comment">#|-- 序列号</span></span><br><span class="line">  time stamp                                <span class="comment">#|-- 时间戳</span></span><br><span class="line">  string frame_id                            <span class="comment">#|-- 坐标 ID</span></span><br><span class="line">string child_frame_id                    <span class="comment">#子坐标系的 id</span></span><br><span class="line">geometry_msgs/Transform transform        <span class="comment">#坐标信息</span></span><br><span class="line">  geometry_msgs/Vector3 translation        <span class="comment">#偏移量</span></span><br><span class="line">    float64 x                                <span class="comment">#|-- X 方向的偏移量</span></span><br><span class="line">    float64 y                                <span class="comment">#|-- Y 方向的偏移量</span></span><br><span class="line">    float64 z                                <span class="comment">#|-- Z 方向上的偏移量</span></span><br><span class="line">  geometry_msgs/Quaternion rotation        <span class="comment">#四元数，右手法则</span></span><br><span class="line">    float64 x                                <span class="comment">#|-- 水平面的偏移方向，绕Z轴转</span></span><br><span class="line">    float64 y                                <span class="comment">#|-- 俯仰面的偏移方向，绕Y轴转</span></span><br><span class="line">    float64 z                                <span class="comment">#|-- 翻滚面的偏移方向，绕X轴转</span></span><br><span class="line">    float64 w</span><br></pre></td></tr></table></figure>

<p>四元数用于表示坐标的相对姿态</p>
<p><strong>2. geometry_msgs&#x2F;PointStamped</strong></p>
<p>命令行键入:<code>rosmsg info geometry_msgs/PointStamped</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header                    <span class="comment">#头</span></span><br><span class="line">  uint32 seq                                <span class="comment">#|-- 序号</span></span><br><span class="line">  time stamp                                <span class="comment">#|-- 时间戳</span></span><br><span class="line">  string frame_id                            <span class="comment">#|-- 所属坐标系的 id</span></span><br><span class="line">geometry_msgs/Point point                <span class="comment">#点坐标</span></span><br><span class="line">  float64 x                                    <span class="comment">#|-- x y z 坐标</span></span><br><span class="line">  float64 y</span><br><span class="line">  float64 z</span><br></pre></td></tr></table></figure>



<h2 id="5-1-2-静态坐标变换"><a href="#5-1-2-静态坐标变换" class="headerlink" title="5.1.2 静态坐标变换"></a>5.1.2 静态坐标变换</h2><p>所谓静态坐标变换，是指两个坐标系之间的相对位置是固定的。</p>
<p><strong>需求描述:</strong></p>
<p>现有一机器人模型，核心构成包含主体与雷达，各对应一坐标系，坐标系的原点分别位于主体与雷达的物理中心，已知雷达原点相对于主体原点位移关系如下: x 0.2 y0.0 z0.5。当前雷达检测到一障碍物，在雷达坐标系中障碍物的坐标为 (2.0 3.0 5.0),请问，该障碍物相对于主体的坐标是多少？</p>
<p>**结果演示:**（命令行键入 rviz）</p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/image-20240606144619843.png" alt="image-20240606144619843"></p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/image-20240606144603696.png" alt="image-20240606144603696"></p>
<p><strong>实现分析:</strong></p>
<ol>
<li>坐标系相对关系，可以通过发布方发布</li>
<li>订阅方，订阅到发布的坐标系相对关系，再传入坐标点信息(可以写死)，然后借助于 tf 实现坐标变换，并将结果输出</li>
</ol>
<p>**实现流程:**C++ 与 Python 实现流程一致</p>
<ol>
<li>新建功能包，添加依赖</li>
<li>编写发布方实现</li>
<li>编写订阅方实现</li>
<li>执行并查看结果</li>
</ol>
<hr>
<h3 id="1-创建功能包"><a href="#1-创建功能包" class="headerlink" title="1.创建功能包"></a>1.创建功能包</h3><p>创建项目功能包依赖于 <code>tf2 tf2_ros tf2_geometry_msgs roscpp rospy std_msgs geometry_msgs</code></p>
<h3 id="2-发布方"><a href="#2-发布方" class="headerlink" title="2.发布方"></a>2.发布方</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    静态坐标变换发布方:</span></span><br><span class="line"><span class="comment">        发布关于 laser 坐标系的位置信息 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建静态坐标转换广播器</span></span><br><span class="line"><span class="comment">        4.创建坐标系信息</span></span><br><span class="line"><span class="comment">        5.广播器发布坐标系信息</span></span><br><span class="line"><span class="comment">        6.spin()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.包含头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/static_transform_broadcaster.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2/LinearMath/Quaternion.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ROS 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;static_brocast&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.创建静态坐标转换广播器</span></span><br><span class="line">    tf2_ros::StaticTransformBroadcaster broadcaster;</span><br><span class="line">    <span class="comment">// 4.创建坐标系信息</span></span><br><span class="line">    geometry_msgs::TransformStamped ts;</span><br><span class="line">    <span class="comment">//----设置头信息</span></span><br><span class="line">    ts.header.seq = <span class="number">100</span>;</span><br><span class="line">    ts.header.stamp = ros::Time::<span class="built_in">now</span>(); <span class="comment">// </span></span><br><span class="line">    ts.header.frame_id = <span class="string">&quot;base_link&quot;</span>; <span class="comment">// 相对关系中被参考的那个点，即原点或者说起点 </span></span><br><span class="line">    <span class="comment">//----设置子级坐标系</span></span><br><span class="line">    ts.child_frame_id = <span class="string">&quot;laser&quot;</span>;</span><br><span class="line">    <span class="comment">//----设置子级相对于父级的偏移量</span></span><br><span class="line">    ts.transform.translation.x = <span class="number">0.2</span>;</span><br><span class="line">    ts.transform.translation.y = <span class="number">0.0</span>;</span><br><span class="line">    ts.transform.translation.z = <span class="number">0.5</span>;</span><br><span class="line">    <span class="comment">//----设置四元数:将 欧拉角数据转换成四元数</span></span><br><span class="line">    tf2::Quaternion qtn;</span><br><span class="line">    qtn.<span class="built_in">setRPY</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    ts.transform.rotation.x = qtn.<span class="built_in">getX</span>();</span><br><span class="line">    ts.transform.rotation.y = qtn.<span class="built_in">getY</span>();</span><br><span class="line">    ts.transform.rotation.z = qtn.<span class="built_in">getZ</span>();</span><br><span class="line">    ts.transform.rotation.w = qtn.<span class="built_in">getW</span>();</span><br><span class="line">    <span class="comment">// 5.广播器发布坐标系信息</span></span><br><span class="line">    broadcaster.<span class="built_in">sendTransform</span>(ts);</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置文件此处略。</p>
<h3 id="3-订阅方"><a href="#3-订阅方" class="headerlink" title="3.订阅方"></a>3.订阅方</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    订阅坐标系信息，生成一个相对于 子级坐标系的坐标点数据，转换成父级坐标系中的坐标点</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建 TF 订阅节点</span></span><br><span class="line"><span class="comment">        4.生成一个坐标点(相对于子级坐标系)</span></span><br><span class="line"><span class="comment">        5.转换坐标点(相对于父级坐标系)</span></span><br><span class="line"><span class="comment">        6.spin()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//1.包含头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_listener.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/buffer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/PointStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_geometry_msgs/tf2_geometry_msgs.h&quot;</span> <span class="comment">//注意: 调用 transform 必须包含该头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ROS 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;tf_sub&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 3.创建 TF 订阅节点</span></span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">listener</span><span class="params">(buffer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">// 4.生成一个坐标点(相对于子级坐标系)，即模拟雷达检测到的目标与雷达的距离</span></span><br><span class="line">        geometry_msgs::PointStamped point_laser;</span><br><span class="line">        point_laser.header.frame_id = <span class="string">&quot;laser&quot;</span>;</span><br><span class="line">        point_laser.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">        point_laser.point.x = <span class="number">1</span>;</span><br><span class="line">        point_laser.point.y = <span class="number">2</span>;</span><br><span class="line">        point_laser.point.z = <span class="number">7.3</span>;</span><br><span class="line">    <span class="comment">// 5.转换坐标点(相对于父级坐标系)</span></span><br><span class="line">        <span class="comment">//--------------使用 try 语句或休眠，否则可能由于缓存接收延迟而导致坐标转换失败------------------------</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;	<span class="comment">//新建一个坐标点，用于接收转换结果  </span></span><br><span class="line">            geometry_msgs::PointStamped point_base;</span><br><span class="line">            <span class="comment">/* 运行时存在的问题：抛出一个异常 base_link 不存在</span></span><br><span class="line"><span class="comment">            				原因：订阅数据是一个耗时的操作，可能再调用 transform 转换函数时，坐标系的相对关系还没有订阅到，因此出现异常。</span></span><br><span class="line"><span class="comment">            				解决：</span></span><br><span class="line"><span class="comment">            					方案1：在调用转换函数前，执行休眠</span></span><br><span class="line"><span class="comment">                                方案2：进行异常处理</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            point_base = buffer.<span class="built_in">transform</span>(point_laser,<span class="string">&quot;base_link&quot;</span>);</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;转换后的数据:(%.2f,%.2f,%.2f),参考的坐标系是:%s&quot;</span>,point_base.point.x,point_base.point.y,point_base.point.z,point_base.header.frame_id.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// std::cerr &lt;&lt; e.what() &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;程序异常.....&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">sleep</span>();  </span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-1-3-动态坐标变换"><a href="#5-1-3-动态坐标变换" class="headerlink" title="5.1.3 动态坐标变换"></a>5.1.3 动态坐标变换</h2><p>所谓动态坐标变换，是指两个坐标系之间的相对位置是变化的。</p>
<p><strong>需求描述:</strong></p>
<p>启动 turtlesim_node,该节点中窗体有一个世界坐标系(左下角为坐标系原点)，乌龟是另一个坐标系，键盘控制乌龟运动，将两个坐标系的相对位置动态发布。</p>
<p><strong>结果演示:</strong></p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2_%E5%8A%A8%E6%80%81.gif" alt="img"></p>
<p><strong>实现分析:</strong></p>
<ol>
<li>乌龟本身不但可以看作坐标系，也是世界坐标系中的一个坐标点</li>
<li>订阅 turtle1&#x2F;pose,可以获取乌龟在世界坐标系的 x坐标、y坐标、偏移量以及线速度和角速度</li>
<li>将 pose 信息转换成 坐标系相对信息并发布</li>
</ol>
<p><strong>实现流程:</strong></p>
<ol>
<li>新建功能包，添加依赖</li>
<li>创建坐标相对关系发布方(同时需要订阅乌龟位姿信息)</li>
<li>创建坐标相对关系订阅方</li>
<li>执行</li>
</ol>
<hr>
<p>方案A:C++实现</p>
<h3 id="1-创建功能包-1"><a href="#1-创建功能包-1" class="headerlink" title="1.创建功能包"></a>1.创建功能包</h3><p>创建项目功能包依赖于 tf2、tf2_ros、tf2_geometry_msgs、roscpp rospy std_msgs geometry_msgs、turtlesim</p>
<h3 id="2-发布方-1"><a href="#2-发布方-1" class="headerlink" title="2.发布方"></a>2.发布方</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    动态的坐标系相对姿态发布(一个坐标系相对于另一个坐标系的相对姿态是不断变动的)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    需求: 启动 turtlesim_node,该节点中窗体有一个世界坐标系(左下角为坐标系原点)，乌龟是另一个坐标系，键盘</span></span><br><span class="line"><span class="comment">    控制乌龟运动，将两个坐标系的相对位置动态发布</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    实现分析:</span></span><br><span class="line"><span class="comment">        1.乌龟本身不但可以看作坐标系，也是世界坐标系中的一个坐标点</span></span><br><span class="line"><span class="comment">        2.订阅 turtle1/pose,可以获取乌龟在世界坐标系的 x坐标、y坐标、偏移量以及线速度和角速度</span></span><br><span class="line"><span class="comment">        3.将 pose 信息转换成 坐标系相对信息并发布</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ROS 节点</span></span><br><span class="line"><span class="comment">        3.创建 ROS 句柄</span></span><br><span class="line"><span class="comment">        4.创建订阅对象</span></span><br><span class="line"><span class="comment">        5.回调函数处理订阅到的数据(实现TF广播)</span></span><br><span class="line"><span class="comment">            5-1.创建 TF 广播器</span></span><br><span class="line"><span class="comment">            5-2.创建 广播的数据(通过 pose 设置)</span></span><br><span class="line"><span class="comment">            5-3.广播器发布数据</span></span><br><span class="line"><span class="comment">        6.spin</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 1.包含头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_broadcaster.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2/LinearMath/Quaternion.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPose</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr&amp; pose)</span></span>&#123;</span><br><span class="line">    <span class="comment">//  5-1.创建 TF 广播器</span></span><br><span class="line">    <span class="type">static</span> tf2_ros::TransformBroadcaster broadcaster;</span><br><span class="line">    <span class="comment">//  5-2.创建 广播的数据(通过 pose 设置)</span></span><br><span class="line">    geometry_msgs::TransformStamped tfs;</span><br><span class="line">    <span class="comment">//  |----头设置</span></span><br><span class="line">    tfs.header.frame_id = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">    tfs.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  |----坐标系 ID</span></span><br><span class="line">    tfs.child_frame_id = <span class="string">&quot;turtle1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  |----坐标系相对信息设置</span></span><br><span class="line">    tfs.transform.translation.x = pose-&gt;x;</span><br><span class="line">    tfs.transform.translation.y = pose-&gt;y;</span><br><span class="line">    tfs.transform.translation.z = <span class="number">0.0</span>; <span class="comment">// 二维实现，pose 中没有z，z 是 0</span></span><br><span class="line">    <span class="comment">//  |--------- 四元数设置</span></span><br><span class="line">    tf2::Quaternion qtn;</span><br><span class="line">    qtn.<span class="built_in">setRPY</span>(<span class="number">0</span>,<span class="number">0</span>,pose-&gt;theta);</span><br><span class="line">    tfs.transform.rotation.x = qtn.<span class="built_in">getX</span>();</span><br><span class="line">    tfs.transform.rotation.y = qtn.<span class="built_in">getY</span>();</span><br><span class="line">    tfs.transform.rotation.z = qtn.<span class="built_in">getZ</span>();</span><br><span class="line">    tfs.transform.rotation.w = qtn.<span class="built_in">getW</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//  5-3.广播器发布数据</span></span><br><span class="line">    broadcaster.<span class="built_in">sendTransform</span>(tfs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ROS 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;dynamic_tf_pub&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.创建 ROS 句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 4.创建订阅对象</span></span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>&lt;turtlesim::Pose&gt;(<span class="string">&quot;/turtle1/pose&quot;</span>,<span class="number">1000</span>,doPose);</span><br><span class="line">    <span class="comment">//     5.回调函数处理订阅到的数据(实现TF广播)</span></span><br><span class="line">    <span class="comment">//        </span></span><br><span class="line">    <span class="comment">// 6.spin</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>配置文件此处略。</p>
<h3 id="3-订阅方-1"><a href="#3-订阅方-1" class="headerlink" title="3.订阅方"></a>3.订阅方</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.包含头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_listener.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/buffer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/PointStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_geometry_msgs/tf2_geometry_msgs.h&quot;</span> <span class="comment">//注意: 调用 transform 必须包含该头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ROS 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;dynamic_tf_sub&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 3.创建 TF 订阅节点</span></span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">listener</span><span class="params">(buffer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">// 4.生成一个坐标点(相对于子级坐标系)</span></span><br><span class="line">        geometry_msgs::PointStamped point_laser;</span><br><span class="line">        point_laser.header.frame_id = <span class="string">&quot;turtle1&quot;</span>;</span><br><span class="line">        point_laser.header.stamp = ros::<span class="built_in">Time</span>(); <span class="comment">// 不设置成 now 是为了防止因时间差较大导致的系统自动判错</span></span><br><span class="line">        point_laser.point.x = <span class="number">1</span>;</span><br><span class="line">        point_laser.point.y = <span class="number">1</span>;</span><br><span class="line">        point_laser.point.z = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 5.转换坐标点(相对于父级坐标系)</span></span><br><span class="line">        <span class="comment">//新建一个坐标点，用于接收转换结果  </span></span><br><span class="line">        <span class="comment">//--------------使用 try 语句或休眠，否则可能由于缓存接收延迟而导致坐标转换失败------------------------</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            geometry_msgs::PointStamped point_base;</span><br><span class="line">            point_base = buffer.<span class="built_in">transform</span>(point_laser,<span class="string">&quot;world&quot;</span>);</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;坐标点相对于 world 的坐标为:(%.2f,%.2f,%.2f)&quot;</span>,point_base.point.x,point_base.point.y,point_base.point.z);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// std::cerr &lt;&lt; e.what() &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;程序异常:%s&quot;</span>,e.<span class="built_in">what</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">sleep</span>();  </span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置文件此处略。</p>
<h3 id="4-执行"><a href="#4-执行" class="headerlink" title="4.执行"></a>4.执行</h3><p>可以使用命令行或launch文件的方式分别启动发布节点与订阅节点，如果程序无异常，与演示结果类似。</p>
<p>可以使用 rviz 查看坐标系相对关系</p>
<h2 id="5-1-4-多坐标变换"><a href="#5-1-4-多坐标变换" class="headerlink" title="5.1.4 多坐标变换"></a>5.1.4 多坐标变换</h2><p><strong>需求描述:</strong></p>
<p>现有坐标系统，父级坐标系统 world,下有两子级系统 son1，son2，son1 相对于 world，以及 son2 相对于 world 的关系是已知的，求 son1原点在 son2中的坐标，又已知在 son1中一点的坐标，要求求出该点在 son2 中的坐标</p>
<p><strong>实现分析:</strong></p>
<ol>
<li>首先，需要发布 son1 相对于 world，以及 son2 相对于 world 的坐标消息</li>
<li>然后，需要订阅坐标发布消息，并取出订阅的消息，借助于 tf2 实现 son1 和 son2 的转换</li>
<li>最后，还要实现坐标点的转换</li>
</ol>
<p><strong>实现流程:</strong></p>
<ol>
<li>新建功能包，添加依赖</li>
<li>创建坐标相对关系发布方(需要发布两个坐标相对关系)</li>
<li>创建坐标相对关系订阅方</li>
<li>执行</li>
</ol>
<hr>
<h3 id="1-创建功能包-2"><a href="#1-创建功能包-2" class="headerlink" title="1. 创建功能包"></a>1. 创建功能包</h3><p>创建项目功能包依赖于 tf2 tf2_ros tf2_geometry_msgs roscpp rospy std_msgs geometry_msgs turtlesim</p>
<h3 id="2-发布方-2"><a href="#2-发布方-2" class="headerlink" title="2. 发布方"></a>2. 发布方</h3><p>为了方便，使用静态坐标变换发布</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;tf2_ros&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;son1&quot;</span> <span class="attr">args</span>=<span class="string">&quot;0.2 0.8 0.3 0 0 0 /world /son1&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;tf2_ros&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;son2&quot;</span> <span class="attr">args</span>=<span class="string">&quot;0.5 0 0 0 0 0 /world /son2&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-订阅方-2"><a href="#3-订阅方-2" class="headerlink" title="3. 订阅方"></a>3. 订阅方</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">需求:</span></span><br><span class="line"><span class="comment">    现有坐标系统，父级坐标系统 world,下有两子级系统 son1，son2，</span></span><br><span class="line"><span class="comment">    son1 相对于 world，以及 son2 相对于 world 的关系是已知的，</span></span><br><span class="line"><span class="comment">    求 son1 与 son2中的坐标关系，又已知在 son1中一点的坐标，要求求出该点在 son2 中的坐标</span></span><br><span class="line"><span class="comment">实现流程:</span></span><br><span class="line"><span class="comment">    1.包含头文件</span></span><br><span class="line"><span class="comment">    2.初始化 ros 节点</span></span><br><span class="line"><span class="comment">    3.创建 ros 句柄</span></span><br><span class="line"><span class="comment">    4.创建 TF 订阅对象</span></span><br><span class="line"><span class="comment">    5.解析订阅信息中获取 son1 坐标系原点在 son2 中的坐标</span></span><br><span class="line"><span class="comment">      解析 son1 中的点相对于 son2 的坐标</span></span><br><span class="line"><span class="comment">    6.spin</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//1.包含头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_listener.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2/LinearMath/Quaternion.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_geometry_msgs/tf2_geometry_msgs.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/PointStamped.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;   <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ros 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;sub_frames&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.创建 ros 句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 4.创建 TF 订阅对象</span></span><br><span class="line">    tf2_ros::Buffer buffer; </span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">listener</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    <span class="comment">// 5.解析订阅信息中获取 son1 坐标系原点在 son2 中的坐标</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">//   解析 son1 中的点相对于 son2 的坐标</span></span><br><span class="line">            geometry_msgs::TransformStamped tfs = buffer.<span class="built_in">lookupTransform</span>(<span class="string">&quot;son2&quot;</span>,<span class="string">&quot;son1&quot;</span>,ros::<span class="built_in">Time</span>(<span class="number">0</span>));</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Son1 相对于 Son2 的坐标关系:父坐标系ID=%s&quot;</span>,tfs.header.frame_id.<span class="built_in">c_str</span>());</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Son1 相对于 Son2 的坐标关系:子坐标系ID=%s&quot;</span>,tfs.child_frame_id.<span class="built_in">c_str</span>());</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Son1 相对于 Son2 的坐标关系:x=%.2f,y=%.2f,z=%.2f&quot;</span>,</span><br><span class="line">                    tfs.transform.translation.x,</span><br><span class="line">                    tfs.transform.translation.y,</span><br><span class="line">                    tfs.transform.translation.z</span><br><span class="line">                    );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 坐标点解析</span></span><br><span class="line">            geometry_msgs::PointStamped ps;</span><br><span class="line">            ps.header.frame_id = <span class="string">&quot;son1&quot;</span>;</span><br><span class="line">            ps.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">            ps.point.x = <span class="number">1.0</span>;</span><br><span class="line">            ps.point.y = <span class="number">2.0</span>;</span><br><span class="line">            ps.point.z = <span class="number">3.0</span>;</span><br><span class="line"></span><br><span class="line">            geometry_msgs::PointStamped psAtSon2;</span><br><span class="line">            psAtSon2 = buffer.<span class="built_in">transform</span>(ps,<span class="string">&quot;son2&quot;</span>);</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;在 Son2 中的坐标:x=%.2f,y=%.2f,z=%.2f&quot;</span>,</span><br><span class="line">                    psAtSon2.point.x,</span><br><span class="line">                    psAtSon2.point.y,</span><br><span class="line">                    psAtSon2.point.z</span><br><span class="line">                    );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// std::cerr &lt;&lt; e.what() &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;异常信息:%s&quot;</span>,e.<span class="built_in">what</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line">        <span class="comment">// 6.spin</span></span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-1-5-TF坐标变换实操"><a href="#5-1-5-TF坐标变换实操" class="headerlink" title="5.1.5 TF坐标变换实操"></a>5.1.5 TF坐标变换实操</h2><p><strong>需求描述:</strong></p>
<p>程序启动之初: 产生两只乌龟，中间的乌龟(A) 和 左下乌龟(B), B 会自动运行至A的位置，并且键盘控制时，只是控制 A 的运动，但是 B 可以跟随 A 运行</p>
<p><strong>结果演示:</strong></p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/TF%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2.gif" alt="img"></p>
<p><strong>实现分析:</strong></p>
<p>乌龟跟随实现的核心，是乌龟A和B都要发布相对世界坐标系的坐标信息，然后，订阅到该信息需要转换获取A相对于B坐标系的信息，最后，再生成速度信息，并控制B运动。</p>
<ol>
<li>启动乌龟显示节点</li>
<li>在乌龟显示窗体中生成一只新的乌龟(需要使用服务)</li>
<li>编写两只乌龟发布坐标信息的节点</li>
<li>编写订阅节点订阅坐标信息并生成新的相对关系生成速度信息</li>
</ol>
<p><strong>实现流程:</strong></p>
<ol>
<li>新建功能包，添加依赖</li>
<li>编写服务客户端，用于生成一只新的乌龟</li>
<li>编写发布方，发布两只乌龟的坐标信息</li>
<li>编写订阅方，订阅两只乌龟信息，生成速度信息并发布</li>
<li>运行</li>
</ol>
<p><strong>准备工作:</strong></p>
<ol>
<li><p>了解如何创建第二只乌龟，且不受键盘控制</p>
<p>创建第二只乌龟需要使用rosservice,话题使用的是 spawn</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rosservice call /spawn <span class="string">&quot;x: 1.0 y: 1.0 theta: 1.0 name: &#x27;turtle_flow&#x27;&quot;</span> </span><br><span class="line">name: <span class="string">&quot;turtle_flow&quot;</span></span><br></pre></td></tr></table></figure>

<p>键盘是无法控制第二只乌龟运动的，因为使用的话题: &#x2F;第二只乌龟名称&#x2F;cmd_vel,对应的要控制乌龟运动必须发布对应的话题消息</p>
</li>
<li><p>了解如何获取两只乌龟的坐标</p>
<p>是通过话题 &#x2F;乌龟名称&#x2F;pose 来获取的</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x: <span class="number">1.0</span> //x坐标</span><br><span class="line">y: <span class="number">1.0</span> //y坐标</span><br><span class="line">theta: <span class="literal">-1</span>.<span class="number">21437060833</span> //角度</span><br><span class="line">linear_velocity: <span class="number">0.0</span> //线速度</span><br><span class="line">angular_velocity: <span class="number">1.0</span> //角速度</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="1-创建功能包-3"><a href="#1-创建功能包-3" class="headerlink" title="1. 创建功能包"></a>1. 创建功能包</h3><p>创建项目功能包依赖于 tf2 tf2_ros tf2_geometry_msgs roscpp rospy std_msgs geometry_msgs turtlesim</p>
<h3 id="2-服务客户端-生成乌龟"><a href="#2-服务客户端-生成乌龟" class="headerlink" title="2. 服务客户端(生成乌龟)"></a>2. 服务客户端(生成乌龟)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    创建第二只小乌龟</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Spawn.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;create_turtle&quot;</span>);</span><br><span class="line">    <span class="comment">//创建节点</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//创建服务客户端</span></span><br><span class="line">    ros::ServiceClient client = nh.<span class="built_in">serviceClient</span>&lt;turtlesim::Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">    turtlesim::Spawn spawn;</span><br><span class="line">    spawn.request.name = <span class="string">&quot;turtle2&quot;</span>;</span><br><span class="line">    spawn.request.x = <span class="number">1.0</span>;</span><br><span class="line">    spawn.request.y = <span class="number">2.0</span>;</span><br><span class="line">    spawn.request.theta = <span class="number">3.12415926</span>;</span><br><span class="line">    <span class="type">bool</span> flag = client.<span class="built_in">call</span>(spawn);</span><br><span class="line">    <span class="keyword">if</span> (flag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;乌龟%s创建成功!&quot;</span>,spawn.response.name.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;乌龟2创建失败!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置文件此处略。</p>
<h3 id="3-发布方-发布两只乌龟的坐标信息"><a href="#3-发布方-发布两只乌龟的坐标信息" class="headerlink" title="3. 发布方(发布两只乌龟的坐标信息)"></a>3. 发布方(发布两只乌龟的坐标信息)</h3><p>可以订阅乌龟的位姿信息，然后再转换成坐标信息，两只乌龟的实现逻辑相同，只是订阅的话题名称，生成的坐标信息等稍有差异，可以将差异部分通过参数传入:</p>
<ul>
<li>该节点需要启动两次</li>
<li>每次启动时都需要传入乌龟节点名称 (第一次是 turtle1 第二次是 turtle2)</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    该文件实现:需要订阅 turtle1 和 turtle2 的 pose，然后广播相对 world 的坐标系信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    注意: 订阅的两只 turtle,除了命名空间(turtle1 和 turtle2)不同外,</span></span><br><span class="line"><span class="comment">          其他的话题名称和实现逻辑都是一样的，</span></span><br><span class="line"><span class="comment">          所以我们可以将所需的命名空间通过 args 动态传入</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ros 节点</span></span><br><span class="line"><span class="comment">        3.解析传入的命名空间</span></span><br><span class="line"><span class="comment">        4.创建 ros 句柄</span></span><br><span class="line"><span class="comment">        5.创建订阅对象</span></span><br><span class="line"><span class="comment">        6.回调函数处理订阅的 pose 信息</span></span><br><span class="line"><span class="comment">            6-1.创建 TF 广播器</span></span><br><span class="line"><span class="comment">            6-2.将 pose 信息转换成 TransFormStamped</span></span><br><span class="line"><span class="comment">            6-3.发布</span></span><br><span class="line"><span class="comment">        7.spin</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//1.包含头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_broadcaster.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2/LinearMath/Quaternion.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="comment">//保存乌龟名称</span></span><br><span class="line">std::string turtle_name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPose</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr&amp; pose)</span></span>&#123;</span><br><span class="line">    <span class="comment">//  6-1.创建 TF 广播器 ---------------------------------------- 注意 static</span></span><br><span class="line">    <span class="type">static</span> tf2_ros::TransformBroadcaster broadcaster;</span><br><span class="line">    <span class="comment">//  6-2.将 pose 信息转换成 TransFormStamped</span></span><br><span class="line">    geometry_msgs::TransformStamped tfs;</span><br><span class="line">    tfs.header.frame_id = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">    tfs.header.stamp = ros::Time::<span class="built_in">now</span>();</span><br><span class="line">    tfs.child_frame_id = turtle_name;</span><br><span class="line">    tfs.transform.translation.x = pose-&gt;x;</span><br><span class="line">    tfs.transform.translation.y = pose-&gt;y;</span><br><span class="line">    tfs.transform.translation.z = <span class="number">0.0</span>;</span><br><span class="line">    tf2::Quaternion qtn;</span><br><span class="line">    qtn.<span class="built_in">setRPY</span>(<span class="number">0</span>,<span class="number">0</span>,pose-&gt;theta);</span><br><span class="line">    tfs.transform.rotation.x = qtn.<span class="built_in">getX</span>();</span><br><span class="line">    tfs.transform.rotation.y = qtn.<span class="built_in">getY</span>();</span><br><span class="line">    tfs.transform.rotation.z = qtn.<span class="built_in">getZ</span>();</span><br><span class="line">    tfs.transform.rotation.w = qtn.<span class="built_in">getW</span>();</span><br><span class="line">    <span class="comment">//  6-3.发布</span></span><br><span class="line">    broadcaster.<span class="built_in">sendTransform</span>(tfs);</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ros 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;pub_tf&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.解析传入的命名空间</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">&quot;请传入正确的参数&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        turtle_name = argv[<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;乌龟 %s 坐标发送启动&quot;</span>,turtle_name.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.创建 ros 句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 5.创建订阅对象</span></span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>&lt;turtlesim::Pose&gt;(turtle_name + <span class="string">&quot;/pose&quot;</span>,<span class="number">1000</span>,doPose);</span><br><span class="line">    <span class="comment">//     6.回调函数处理订阅的 pose 信息</span></span><br><span class="line">    <span class="comment">//         6-1.创建 TF 广播器</span></span><br><span class="line">    <span class="comment">//         6-2.将 pose 信息转换成 TransFormStamped</span></span><br><span class="line">    <span class="comment">//         6-3.发布</span></span><br><span class="line">    <span class="comment">// 7.spin</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置文件此处略。</p>
<h3 id="4-订阅方-解析坐标信息并生成速度信息"><a href="#4-订阅方-解析坐标信息并生成速度信息" class="headerlink" title="4. 订阅方(解析坐标信息并生成速度信息)"></a>4. 订阅方(解析坐标信息并生成速度信息)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    订阅 turtle1 和 turtle2 的 TF 广播信息，查找并转换时间最近的 TF 信息</span></span><br><span class="line"><span class="comment">    将 turtle1 转换成相对 turtle2 的坐标，在计算线速度和角速度并发布</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    实现流程:</span></span><br><span class="line"><span class="comment">        1.包含头文件</span></span><br><span class="line"><span class="comment">        2.初始化 ros 节点</span></span><br><span class="line"><span class="comment">        3.创建 ros 句柄</span></span><br><span class="line"><span class="comment">        4.创建 TF 订阅对象</span></span><br><span class="line"><span class="comment">        5.处理订阅到的 TF</span></span><br><span class="line"><span class="comment">        6.spin</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//1.包含头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tf2_ros/transform_listener.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/TransformStamped.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;geometry_msgs/Twist.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.初始化 ros 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;sub_TF&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.创建 ros 句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">// 4.创建 TF 订阅对象</span></span><br><span class="line">    tf2_ros::Buffer buffer;</span><br><span class="line">    <span class="function">tf2_ros::TransformListener <span class="title">listener</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    <span class="comment">// 5.处理订阅到的 TF</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 需要创建发布 /turtle2/cmd_vel 的 publisher 对象</span></span><br><span class="line"></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle2/cmd_vel&quot;</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//5-1.先获取 turtle1 相对 turtle2 的坐标信息</span></span><br><span class="line">            geometry_msgs::TransformStamped tfs = buffer.<span class="built_in">lookupTransform</span>(<span class="string">&quot;turtle2&quot;</span>,<span class="string">&quot;turtle1&quot;</span>,ros::<span class="built_in">Time</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5-2.根据坐标信息生成速度信息 -- geometry_msgs/Twist.h</span></span><br><span class="line">            geometry_msgs::Twist twist;</span><br><span class="line">            twist.linear.x = <span class="number">0.5</span> * <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(tfs.transform.translation.x,<span class="number">2</span>) + <span class="built_in">pow</span>(tfs.transform.translation.y,<span class="number">2</span>));</span><br><span class="line">            twist.angular.z = <span class="number">4</span> * <span class="built_in">atan2</span>(tfs.transform.translation.y,tfs.transform.translation.x);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5-3.发布速度信息 -- 需要提前创建 publish 对象</span></span><br><span class="line">            pub.<span class="built_in">publish</span>(twist);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span>(<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// std::cerr &lt;&lt; e.what() &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;错误提示:%s&quot;</span>,e.<span class="built_in">what</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        <span class="comment">// 6.spin</span></span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置文件此处略。</p>
<h3 id="5-运行"><a href="#5-运行" class="headerlink" title="5. 运行"></a>5. 运行</h3><p>使用 launch 文件组织需要运行的节点，内容示例如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    tf2 实现小乌龟跟随案例</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动乌龟节点与键盘控制节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtlesim_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;turtle1&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;turtlesim&quot;</span> <span class="attr">type</span>=<span class="string">&quot;turtle_teleop_key&quot;</span> <span class="attr">name</span>=<span class="string">&quot;key_control&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动创建第二只乌龟的节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;demo_tf2_test&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Test01_Create_Turtle2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;turtle2&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动两个坐标发布节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;demo_tf2_test&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Test02_TF2_Caster&quot;</span> <span class="attr">name</span>=<span class="string">&quot;caster1&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">args</span>=<span class="string">&quot;turtle1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;demo_tf2_test&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Test02_TF2_Caster&quot;</span> <span class="attr">name</span>=<span class="string">&quot;caster2&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">args</span>=<span class="string">&quot;turtle2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启动坐标转换节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;demo_tf2_test&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Test03_TF2_Listener&quot;</span> <span class="attr">name</span>=<span class="string">&quot;listener&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="5-2-rosbag"><a href="#5-2-rosbag" class="headerlink" title="5.2 rosbag"></a>5.2 rosbag</h1><p>机器人传感器获取到的信息，有时我们可能需要处理，有时可能只是采集数据，事后分析，比如:</p>
<blockquote>
<p>机器人导航实现中，可能需要绘制导航所需的全局地图，地图绘制实现，有两种方式，方式1：可以控制机器人运动，将机器人传感器感知到的数据时时处理，生成地图信息。方式2：同样是控制机器人运动，将机器人传感器感知到的数据留存，事后，再重新读取数据，生成地图信息。两种方式比较，显然方式2使用上更为灵活方便。</p>
</blockquote>
<p>在ROS中关于数据的留存以及读取实现，提供了专门的工具: rosbag。</p>
<hr>
<p><strong>概念</strong></p>
<p>是用于录制和回放 ROS 主题的一个工具集。</p>
<p><strong>作用</strong></p>
<p>实现了数据的复用，方便调试、测试。</p>
<p><strong>本质</strong></p>
<p>rosbag本质也是ros的节点，当录制时，rosbag是一个订阅节点，可以订阅话题消息并将订阅到的数据写入磁盘文件；当重放时，rosbag是一个发布节点，可以读取磁盘文件，发布文件中的话题消息。</p>
<h2 id="5-2-1-rosbag-使用-命令行"><a href="#5-2-1-rosbag-使用-命令行" class="headerlink" title="5.2.1 rosbag 使用_命令行"></a>5.2.1 rosbag 使用_命令行</h2><p><strong>需求:</strong></p>
<p>ROS 内置的乌龟案例并操作，操作过程中使用 rosbag 录制，录制结束后，实现重放</p>
<p><strong>实现:</strong></p>
<ol>
<li><p>准备</p>
<p>创建目录保存录制的文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ./xxx</span><br><span class="line"><span class="built_in">cd</span> xxx</span><br></pre></td></tr></table></figure>
</li>
<li><p>开始录制</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosbag record <span class="literal">-a</span> <span class="literal">-O</span> 目标文件</span><br></pre></td></tr></table></figure>

<p>操作小乌龟一段时间，结束录制使用 ctrl + c，在创建的目录中会生成bag文件。</p>
</li>
<li><p>查看文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosbag info 文件名</span><br></pre></td></tr></table></figure>
</li>
<li><p>回放文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosbag play 文件名</span><br></pre></td></tr></table></figure>

<p>重启乌龟节点，会发现，乌龟按照录制时的轨迹运动。</p>
</li>
</ol>
<h2 id="5-2-2-rosbag使用-编码"><a href="#5-2-2-rosbag使用-编码" class="headerlink" title="5.2.2 rosbag使用_编码"></a>5.2.2 rosbag使用_编码</h2><p>命令实现不够灵活，可以使用编码的方式，增强录制与回放的灵活性,本节将通过简单的读写实现演示rosbag的编码实现。</p>
<hr>
<p>方案A:C++实现</p>
<h3 id="1-写-bag"><a href="#1-写-bag" class="headerlink" title="1. 写 bag"></a>1. 写 bag</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rosbag/bag.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;bag_write&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//创建bag对象</span></span><br><span class="line">    rosbag::Bag bag;</span><br><span class="line">    <span class="comment">//打开</span></span><br><span class="line">    bag.<span class="built_in">open</span>(<span class="string">&quot;/home/rosdemo/demo/test.bag&quot;</span>,rosbag::BagMode::Write);</span><br><span class="line">    <span class="comment">//写</span></span><br><span class="line">    std_msgs::String msg;</span><br><span class="line">    msg.data = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    bag.<span class="built_in">write</span>(<span class="string">&quot;/chatter&quot;</span>,ros::Time::<span class="built_in">now</span>(),msg);</span><br><span class="line">    bag.<span class="built_in">write</span>(<span class="string">&quot;/chatter&quot;</span>,ros::Time::<span class="built_in">now</span>(),msg);</span><br><span class="line">    bag.<span class="built_in">write</span>(<span class="string">&quot;/chatter&quot;</span>,ros::Time::<span class="built_in">now</span>(),msg);</span><br><span class="line">    bag.<span class="built_in">write</span>(<span class="string">&quot;/chatter&quot;</span>,ros::Time::<span class="built_in">now</span>(),msg);</span><br><span class="line">    <span class="comment">//关闭</span></span><br><span class="line">    bag.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-读bag"><a href="#2-读bag" class="headerlink" title="2. 读bag"></a>2. 读bag</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    读取 bag 文件：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rosbag/bag.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rosbag/view.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/Int32.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;bag_read&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建 bag 对象</span></span><br><span class="line">    rosbag::Bag bag;</span><br><span class="line">    <span class="comment">//打开 bag 文件</span></span><br><span class="line">    bag.<span class="built_in">open</span>(<span class="string">&quot;/home/rosdemo/demo/test.bag&quot;</span>,rosbag::BagMode::Read);</span><br><span class="line">    <span class="comment">//读数据</span></span><br><span class="line">    <span class="keyword">for</span> (rosbag::MessageInstance <span class="type">const</span> m : rosbag::<span class="built_in">View</span>(bag))</span><br><span class="line">    &#123;</span><br><span class="line">        std_msgs::String::ConstPtr p = m.<span class="built_in">instantiate</span>&lt;std_msgs::String&gt;();</span><br><span class="line">        <span class="keyword">if</span>(p != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="built_in">ROS_INFO</span>(<span class="string">&quot;读取的数据:%s&quot;</span>,p-&gt;data.<span class="built_in">c_str</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭文件流</span></span><br><span class="line">    bag.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-3-rqt工具箱"><a href="#5-3-rqt工具箱" class="headerlink" title="5.3 rqt工具箱"></a>5.3 rqt工具箱</h1><p>之前，在 ROS 中使用了一些实用的工具,比如: ros_bag 用于录制与回放、tf2_tools 可以生成 TF 树 ….. 这些工具大大提高了开发的便利性，但是也存在一些问题: 这些工具的启动和使用过程中涉及到一些命令操作，应用起来不够方便，在ROS中，提供了rqt工具箱，在调用工具时以图形化操作代替了命令操作，应用更便利，提高了操作效率，优化了用户体验。</p>
<hr>
<p><strong>概念</strong></p>
<p>ROS基于 QT 框架，针对机器人开发提供了一系列可视化的工具，这些工具的集合就是rqt</p>
<p><strong>作用</strong></p>
<p>可以方便的实现 ROS 可视化调试，并且在同一窗口中打开多个部件，提高开发效率，优化用户体验。</p>
<p><strong>组成</strong></p>
<p>rqt 工具箱组成有三大部分</p>
<ul>
<li>rqt——核心实现，开发人员无需关注</li>
<li>rqt_common_plugins——rqt 中常用的工具套件</li>
<li>rqt_robot_plugins——运行中和机器人交互的插件(比如: rviz)</li>
</ul>
<h2 id="5-3-1-rqt安装启动与基本使用"><a href="#5-3-1-rqt安装启动与基本使用" class="headerlink" title="5.3.1 rqt安装启动与基本使用"></a>5.3.1 rqt安装启动与基本使用</h2><p><strong>1.安装</strong></p>
<ul>
<li><p>一般只要你安装的是desktop-full版本就会自带工具箱</p>
</li>
<li><p>如果需要安装可以以如下方式安装</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> sudo apt<span class="literal">-get</span> install ros<span class="literal">-noetic-rqt</span></span><br><span class="line"><span class="variable">$</span> sudo apt<span class="literal">-get</span> install ros<span class="literal">-noetic-rqt-common-plugins</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>2.启动</strong></p>
<p><code>rqt</code>的启动方式有两种:</p>
<ul>
<li>方式1:<code>rqt</code></li>
<li>方式2:<code>rosrun rqt_gui rqt_gui</code></li>
</ul>
<p><strong>3.基本使用</strong></p>
<p>启动 rqt 之后，可以通过 plugins 添加所需的插件</p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/image-20240606145032177.png" alt="image-20240606145032177"></p>
<h2 id="5-3-2-rqt常用插件-rqt-graph"><a href="#5-3-2-rqt常用插件-rqt-graph" class="headerlink" title="5.3.2 rqt常用插件:rqt_graph"></a>5.3.2 rqt常用插件:rqt_graph</h2><p>**简介:**可视化显示计算图</p>
<p>**启动:**可以在 rqt 的 plugins 中添加，或者使用<code>rqt_graph</code>启动</p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/image-20240606145104665.png" alt="image-20240606145104665"></p>
<h2 id="5-3-3-rqt常用插件-rqt-console"><a href="#5-3-3-rqt常用插件-rqt-console" class="headerlink" title="5.3.3 rqt常用插件:rqt_console"></a>5.3.3 rqt常用插件:rqt_console</h2><p>**简介:**rqt_console 是 ROS 中用于显示和过滤日志的图形化插件</p>
<p>**准备:**编写 Node 节点输出各个级别的日志信息</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">    ROS 节点:输出各种级别的日志信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;log_demo&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">0.3</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">ROS_DEBUG</span>(<span class="string">&quot;Debug message d&quot;</span>);</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Info message oooooooooooooo&quot;</span>);</span><br><span class="line">        <span class="built_in">ROS_WARN</span>(<span class="string">&quot;Warn message wwwww&quot;</span>);</span><br><span class="line">        <span class="built_in">ROS_ERROR</span>(<span class="string">&quot;Erroe message EEEEEEEEEEEEEEEEEEEE&quot;</span>);</span><br><span class="line">        <span class="built_in">ROS_FATAL</span>(<span class="string">&quot;Fatal message FFFFFFFFFFFFFFFFFFFFFFFFFFFFF&quot;</span>);</span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>启动:</strong></p>
<p>可以在 rqt 的 plugins 中添加，或者使用<code>rqt_console</code>启动</p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/image-20240606145136457.png" alt="image-20240606145136457"></p>
<h2 id="5-3-4-rqt常用插件-rqt-plot"><a href="#5-3-4-rqt常用插件-rqt-plot" class="headerlink" title="5.3.4 rqt常用插件:rqt_plot"></a>5.3.4 rqt常用插件:rqt_plot</h2><p>**简介:**图形绘制插件，可以以 2D 绘图的方式绘制发布在 topic 上的数据</p>
<p>**准备:**启动 turtlesim 乌龟节点与键盘控制节点，通过 rqt_plot 获取乌龟位姿</p>
<p>**启动:**可以在 rqt 的 plugins 中添加，或者使用<code>rqt_plot</code>启动</p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/image-20240606145303743.png" alt="image-20240606145303743"></p>
<h2 id="5-3-5-rqt常用插件-rqt-bag"><a href="#5-3-5-rqt常用插件-rqt-bag" class="headerlink" title="5.3.5 rqt常用插件:rqt_bag"></a>5.3.5 rqt常用插件:rqt_bag</h2><p>**简介:**录制和重放 bag 文件的图形化插件</p>
<p>**准备:**启动 turtlesim 乌龟节点与键盘控制节点</p>
<p>**启动:**可以在 rqt 的 plugins 中添加，或者使用<code>rqt_bag</code>启动</p>
<p><strong>录制:</strong></p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/image-20240606150036521.png" alt="image-20240606150036521"></p>
<p><strong>重放:</strong></p>
<p><img src="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/image-20240606150123430.png" alt="image-20240606150123430"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ros/">ros</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/06/08/6-%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F/" title="6 机器人系统仿真"><img class="cover" src="/./images/%E5%B0%81%E9%9D%A2-ros.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">6 机器人系统仿真</div></div></a></div><div class="next-post pull-right"><a href="/2024/05/07/4-ros%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86/" title="4 ros运行管理"><img class="cover" src="/./images/%E5%B0%81%E9%9D%A2-ros.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">4 ros运行管理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/05/07/4-ros%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86/" title="4 ros运行管理"><img class="cover" src="/./images/%E5%B0%81%E9%9D%A2-ros.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-07</div><div class="title">4 ros运行管理</div></div></a></div><div><a href="/2024/06/08/6-%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F/" title="6 机器人系统仿真"><img class="cover" src="/./images/%E5%B0%81%E9%9D%A2-ros.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-08</div><div class="title">6 机器人系统仿真</div></div></a></div><div><a href="/2024/05/02/1-ros%E6%A6%82%E8%BF%B0%E4%B8%8E%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" title="1 ros概述与编程基础"><img class="cover" src="/./images/%E5%B0%81%E9%9D%A2-ros.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-02</div><div class="title">1 ros概述与编程基础</div></div></a></div><div><a href="/2024/05/03/2-ros%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6/" title="2-ros通信机制"><img class="cover" src="/./images/%E5%B0%81%E9%9D%A2-ros.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-03</div><div class="title">2-ros通信机制</div></div></a></div><div><a href="/2024/05/04/3-ros%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E8%BF%9B%E9%98%B6/" title="3 ros通信机制的进阶"><img class="cover" src="/./images/%E5%B0%81%E9%9D%A2-ros.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-04</div><div class="title">3 ros通信机制的进阶</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">雪尘</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#5-1-TF%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-text">5.1 TF坐标变换</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-1-%E5%9D%90%E6%A0%87msg%E6%B6%88%E6%81%AF"><span class="toc-text">5.1.1 坐标msg消息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-2-%E9%9D%99%E6%80%81%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-text">5.1.2 静态坐标变换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="toc-text">1.创建功能包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8F%91%E5%B8%83%E6%96%B9"><span class="toc-text">2.发布方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AE%A2%E9%98%85%E6%96%B9"><span class="toc-text">3.订阅方</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-3-%E5%8A%A8%E6%80%81%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-text">5.1.3 动态坐标变换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85-1"><span class="toc-text">1.创建功能包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8F%91%E5%B8%83%E6%96%B9-1"><span class="toc-text">2.发布方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AE%A2%E9%98%85%E6%96%B9-1"><span class="toc-text">3.订阅方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%89%A7%E8%A1%8C"><span class="toc-text">4.执行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-4-%E5%A4%9A%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2"><span class="toc-text">5.1.4 多坐标变换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85-2"><span class="toc-text">1. 创建功能包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8F%91%E5%B8%83%E6%96%B9-2"><span class="toc-text">2. 发布方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AE%A2%E9%98%85%E6%96%B9-2"><span class="toc-text">3. 订阅方</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-5-TF%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E5%AE%9E%E6%93%8D"><span class="toc-text">5.1.5 TF坐标变换实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%8A%9F%E8%83%BD%E5%8C%85-3"><span class="toc-text">1. 创建功能包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9C%8D%E5%8A%A1%E5%AE%A2%E6%88%B7%E7%AB%AF-%E7%94%9F%E6%88%90%E4%B9%8C%E9%BE%9F"><span class="toc-text">2. 服务客户端(生成乌龟)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8F%91%E5%B8%83%E6%96%B9-%E5%8F%91%E5%B8%83%E4%B8%A4%E5%8F%AA%E4%B9%8C%E9%BE%9F%E7%9A%84%E5%9D%90%E6%A0%87%E4%BF%A1%E6%81%AF"><span class="toc-text">3. 发布方(发布两只乌龟的坐标信息)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%AE%A2%E9%98%85%E6%96%B9-%E8%A7%A3%E6%9E%90%E5%9D%90%E6%A0%87%E4%BF%A1%E6%81%AF%E5%B9%B6%E7%94%9F%E6%88%90%E9%80%9F%E5%BA%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">4. 订阅方(解析坐标信息并生成速度信息)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%BF%90%E8%A1%8C"><span class="toc-text">5. 运行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-2-rosbag"><span class="toc-text">5.2 rosbag</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-1-rosbag-%E4%BD%BF%E7%94%A8-%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-text">5.2.1 rosbag 使用_命令行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-2-rosbag%E4%BD%BF%E7%94%A8-%E7%BC%96%E7%A0%81"><span class="toc-text">5.2.2 rosbag使用_编码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%86%99-bag"><span class="toc-text">1. 写 bag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AF%BBbag"><span class="toc-text">2. 读bag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-3-rqt%E5%B7%A5%E5%85%B7%E7%AE%B1"><span class="toc-text">5.3 rqt工具箱</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-1-rqt%E5%AE%89%E8%A3%85%E5%90%AF%E5%8A%A8%E4%B8%8E%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">5.3.1 rqt安装启动与基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-2-rqt%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6-rqt-graph"><span class="toc-text">5.3.2 rqt常用插件:rqt_graph</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-3-rqt%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6-rqt-console"><span class="toc-text">5.3.3 rqt常用插件:rqt_console</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-4-rqt%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6-rqt-plot"><span class="toc-text">5.3.4 rqt常用插件:rqt_plot</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-5-rqt%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6-rqt-bag"><span class="toc-text">5.3.5 rqt常用插件:rqt_bag</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/06/08/6-%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F/" title="6 机器人系统仿真"><img src="/./images/%E5%B0%81%E9%9D%A2-ros.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="6 机器人系统仿真"/></a><div class="content"><a class="title" href="/2024/06/08/6-%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%B3%BB%E7%BB%9F%E4%BB%BF%E7%9C%9F/" title="6 机器人系统仿真">6 机器人系统仿真</a><time datetime="2024-06-08T00:57:42.000Z" title="发表于 2024-06-08 08:57:42">2024-06-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/" title="5 ros常用组件"><img src="/./images/%E5%B0%81%E9%9D%A2-ros.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="5 ros常用组件"/></a><div class="content"><a class="title" href="/2024/05/30/5-ros%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/" title="5 ros常用组件">5 ros常用组件</a><time datetime="2024-05-30T07:37:32.000Z" title="发表于 2024-05-30 15:37:32">2024-05-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/07/4-ros%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86/" title="4 ros运行管理"><img src="/./images/%E5%B0%81%E9%9D%A2-ros.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="4 ros运行管理"/></a><div class="content"><a class="title" href="/2024/05/07/4-ros%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86/" title="4 ros运行管理">4 ros运行管理</a><time datetime="2024-05-07T06:23:34.000Z" title="发表于 2024-05-07 14:23:34">2024-05-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/04/hexo%E7%9A%84%E6%90%AD%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8/" title="hexo的搭建和使用"><img src="/./images/%E5%B0%81%E9%9D%A2-%E6%A0%BC%E5%BC%8F.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo的搭建和使用"/></a><div class="content"><a class="title" href="/2024/05/04/hexo%E7%9A%84%E6%90%AD%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8/" title="hexo的搭建和使用">hexo的搭建和使用</a><time datetime="2024-05-04T06:39:08.000Z" title="发表于 2024-05-04 14:39:08">2024-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/04/3-ros%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E8%BF%9B%E9%98%B6/" title="3 ros通信机制的进阶"><img src="/./images/%E5%B0%81%E9%9D%A2-ros.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3 ros通信机制的进阶"/></a><div class="content"><a class="title" href="/2024/05/04/3-ros%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E8%BF%9B%E9%98%B6/" title="3 ros通信机制的进阶">3 ros通信机制的进阶</a><time datetime="2024-05-04T04:58:38.000Z" title="发表于 2024-05-04 12:58:38">2024-05-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/./images/%E5%B0%81%E9%9D%A2-ros.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 By 雪尘</div><div class="footer_custom_text">Hi, welcome to my blog!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>